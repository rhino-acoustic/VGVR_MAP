name: ğŸ”§ VegaVery Map Generator - Manual Trigger

on:
  # ìˆ˜ë™ ì‹¤í–‰ë§Œ ê°€ëŠ¥
  workflow_dispatch:
    inputs:
      action:
        description: 'ì‹¤í–‰í•  ì‘ì—…'
        required: true
        type: choice
        options:
          - 'ì´ë¯¸ì§€ ìƒì„±'
          - 'ìƒíƒœ í™•ì¸'
          - 'ì „ì²´ í…ŒìŠ¤íŠ¸'
        default: 'ì´ë¯¸ì§€ ìƒì„±'
      
      reason:
        description: 'ì‹¤í–‰ ì´ìœ  (ì„ íƒì‚¬í•­)'
        required: false
        default: 'ìˆ˜ë™ í…ŒìŠ¤íŠ¸'

jobs:
  manual-execution:
    name: ğŸ› ï¸ ìˆ˜ë™ ì‘ì—… ì‹¤í–‰
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸš€ ìˆ˜ë™ ì‹¤í–‰ ì‹œì‘
      run: |
        echo "ğŸ”§ VegaVery Map Generator ìˆ˜ë™ ì‹¤í–‰"
        echo "ğŸ“‹ ì„ íƒëœ ì‘ì—…: ${{ github.event.inputs.action }}"
        echo "ğŸ“ ì‹¤í–‰ ì´ìœ : ${{ github.event.inputs.reason }}"
        echo "â° ì‹¤í–‰ ì‹œê°„: $(TZ='Asia/Seoul' date '+%Y-%m-%d %H:%M:%S KST')"

    - name: ğŸ–¼ï¸ ì´ë¯¸ì§€ ìƒì„± ì‹¤í–‰
      if: github.event.inputs.action == 'ì´ë¯¸ì§€ ìƒì„±' || github.event.inputs.action == 'ì „ì²´ í…ŒìŠ¤íŠ¸'
      run: |
        echo "ğŸ–¼ï¸ ì´ë¯¸ì§€ ìƒì„± ì‘ì—… ì‹œì‘..."
        
        response=$(curl -s -w "\n%{http_code}" "https://vgvr-map.vercel.app/api/generate-images")
        http_code=$(echo "$response" | tail -n1)
        body=$(echo "$response" | head -n -1)
        
        echo "ğŸ“Š HTTP ìƒíƒœ ì½”ë“œ: $http_code"
        echo "ğŸ“ ì‘ë‹µ:"
        echo "$body"
        
        if [ "$http_code" -eq 200 ]; then
          echo "âœ… ì´ë¯¸ì§€ ìƒì„± ì„±ê³µ!"
        else
          echo "âŒ ì´ë¯¸ì§€ ìƒì„± ì‹¤íŒ¨"
          exit 1
        fi

    - name: ğŸ” ìƒíƒœ í™•ì¸
      if: github.event.inputs.action == 'ìƒíƒœ í™•ì¸' || github.event.inputs.action == 'ì „ì²´ í…ŒìŠ¤íŠ¸'
      run: |
        echo "ğŸ” ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸ ì¤‘..."
        
        # ë©”ì¸ í˜ì´ì§€ ìƒíƒœ í™•ì¸
        main_status=$(curl -s -o /dev/null -w "%{http_code}" "https://vgvr-map.vercel.app")
        echo "ğŸŒ ë©”ì¸ í˜ì´ì§€ ìƒíƒœ: $main_status"
        
        # ìƒ˜í”Œ PNG ì´ë¯¸ì§€ ìƒíƒœ í™•ì¸
        png_status=$(curl -s -o /dev/null -w "%{http_code}" "https://vgvr-map.vercel.app/generated-png/ìš©ì¸íŒ€.png")
        echo "ğŸ–¼ï¸ PNG ì´ë¯¸ì§€ ìƒíƒœ: $png_status"
        
        if [ "$main_status" -eq 200 ] && [ "$png_status" -eq 200 ]; then
          echo "âœ… ëª¨ë“  ì„œë¹„ìŠ¤ê°€ ì •ìƒ ì‘ë™ ì¤‘!"
        else
          echo "âš ï¸ ì¼ë¶€ ì„œë¹„ìŠ¤ì— ë¬¸ì œê°€ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤."
        fi

    - name: ğŸ“Š ì‹¤í–‰ ê²°ê³¼ ìš”ì•½
      run: |
        echo "ğŸ¯ ìˆ˜ë™ ì‹¤í–‰ ì™„ë£Œ!"
        echo "ğŸ“‹ ì‹¤í–‰ëœ ì‘ì—…: ${{ github.event.inputs.action }}"
        echo "â° ì™„ë£Œ ì‹œê°„: $(TZ='Asia/Seoul' date '+%Y-%m-%d %H:%M:%S KST')"
        echo ""
        echo "ğŸ”— ìœ ìš©í•œ ë§í¬:"
        echo "  â€¢ ë©”ì¸ í˜ì´ì§€: https://vgvr-map.vercel.app"
        echo "  â€¢ Vercel ëŒ€ì‹œë³´ë“œ: https://vercel.com/rhino-acoustics-projects/vgvr-map"
        echo "  â€¢ GitHub ì €ì¥ì†Œ: https://github.com/rhino-acoustic/VGVR_MAP"
